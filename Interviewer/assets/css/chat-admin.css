/* ====== LAYOUT BIẾN DÙNG CHUNG ====== */
:root{
  --header-h: 74px;      /* cao header */
  --sidebar-w: 250px;    /* rộng sidebar mở */
  --sidebar-wc: 80px;    /* rộng sidebar thu gọn */
}

/* ====== RESET CƠ BẢN ====== */
* { box-sizing: border-box; }

body{
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin:0;
  padding:0;
  /* KHÔNG khóa cuộn – cho phép hiển thị dưới header/sidebar */
  overflow:auto;
  background:#ffffff;
}

/* ====== KHỐI LAYOUT CHÍNH: sidebar + header + main ====== */
.sidebar{
  position: fixed; left:0; top:0; height:100vh;
  width: var(--sidebar-w);
  background:#fff; border-right:1px solid #e5e7eb;
  z-index:50;
  transition: width .3s cubic-bezier(.4,0,.2,1);
}
.sidebar.sidebar-collapsed{ width: var(--sidebar-wc) !important; }

.main-content{
  margin-left: var(--sidebar-w);
  margin-top: var(--header-h);
  min-height: calc(100vh - var(--header-h));
  transition: margin-left .3s cubic-bezier(.4,0,.2,1);
}
.main-content.main-content-collapsed{
  margin-left: var(--sidebar-wc) !important;
}
/* Main content hiển thị full màn hình trừ header + sidebar */
#mainContent {
  margin-left: var(--sidebar-w);
  margin-top: var(--header-h);
  min-height: calc(100vh - var(--header-h));
  height: calc(100vh - var(--header-h));
  display: flex;
  flex-direction: column;
}
.chat-window {
  display: flex;
  flex-direction: column;
  height: calc(100vh - var(--header-h)); /* cố định trong main */
}

.chat-list-wrapper {
  flex: 1;                 /* chiếm hết phần còn lại */
  overflow-y: auto;        /* chỉ lăn danh sách đoạn chat */
  min-width: 280px;        /* thu nhỏ chiều ngang item */
  max-width: 340px;
}

.stories {
  flex-shrink: 0;
  padding: 8px;
  overflow-x: auto;     /* chỉ lăn ngang */
  overflow-y: hidden;   /* ẩn lăn dọc */
  white-space: nowrap;
}

.stories::-webkit-scrollbar {
  height: 6px;          /* scrollbar ngang nhỏ gọn */
}


.chat-messages {
  flex: 1;                  /* chiếm toàn bộ phần còn lại */
  overflow-y: auto;         /* chỉ lăn dọc phần này */
  padding: 16px;
  background: #f9fafb;
}

.chat-item {
  width: 100%;
  max-width: 320px;    /* thu nhỏ chiều ngang */
  margin: 0 auto;      /* căn giữa trong khung */
}

.chat-input {
  flex-shrink: 0;
  border-top: 1px solid #e5e7eb;
  padding: 8px;
  background: #fff;
}

/* Container chat full */
.chat-container {
  flex: 1;
  display: flex;
  flex-direction: row;
  height: 100%; /* chiếm hết */
  overflow: hidden;
}

/* Danh sách bên trái */
.chat-list {
  width: 300px;
  border-right: 1px solid #e5e7eb;
  overflow-y: auto;
}

/* Khung tin nhắn */
.chat-window {
  flex: 1;
  display: flex;
  flex-direction: column;
  height: 100%;
}

/* Khu vực messages cuộn */
.messages {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
}

/* Input ở dưới */
.message-input-area {
  border-top: 1px solid #e5e7eb;
  padding: 12px;
  background: #fff;
}

/* Header (được nạp động) không cắt dropdown */
header, .header{ overflow: visible; }

/* ====== MOBILE / TABLET ====== */
@media (max-width: 1024px){
  .sidebar{
    transform: translateX(-100%);
    transition: transform .3s cubic-bezier(.4,0,.2,1);
    width: var(--sidebar-w); /* mở theo chiều rộng chuẩn */
  }
  .sidebar.open{ transform: translateX(0); }

  /* Trên mobile, nội dung chính không chừa khoảng trái */
  .main-content,
  .main-content.main-content-collapsed{
    margin-left: 0 !important;
  }
}

/* ====== HEADER DROPDOWNS (để hiển thị đúng trên header) ====== */
.header-dropdown{
  position:absolute; right:0; top: calc(100% + .5rem);
  background:#fff; border:1px solid #e5e7eb; border-radius:12px;
  box-shadow:0 20px 40px -8px rgba(0,0,0,.15);
  opacity:0; visibility:hidden; transform: translateY(6px);
  transition: all .18s ease; z-index:70;
}
.header-dropdown.show{
  opacity:1 !important; visibility:visible !important; transform:translateY(0);
  pointer-events:auto !important;
}

/* ====== SCROLLBARS NHẸ ====== */
.custom-scrollbar::-webkit-scrollbar{ width:6px; }
.custom-scrollbar::-webkit-scrollbar-track{ background:transparent; }
.custom-scrollbar::-webkit-scrollbar-thumb{ background:#c4c4c4; border-radius:3px; }
.custom-scrollbar::-webkit-scrollbar-thumb:hover{ background:#a0a0a0; }

/* ====== BUBBLES / CHAT UI (giữ style của bạn) ====== */
.messenger-blue{ background: linear-gradient(135deg,#0084ff 0%,#0066cc 100%); }
.messenger-blue-light{ background:#e7f3ff; }

.message-bubble{
  max-width:70%; word-wrap:break-word; position:relative;
  border-radius:18px; padding:8px 12px; margin:2px 0;
}
.message-bubble.sent{ background:#0084ff; color:#fff; margin-left:auto; border-bottom-right-radius:4px; }
.message-bubble.received{ background:#f0f0f0; color:#050505; border-bottom-left-radius:4px; }
.message-bubble.emoji-only{ background:transparent; font-size:48px; padding:4px; }

.online-dot{
  width:14px; height:14px; background:#42b883; border:2px solid #fff;
  border-radius:50%; position:absolute; bottom:0; right:0;
}

.chat-item:hover{ background:#f2f2f2; }
.chat-item.active{ background:#e7f3ff; }

.message-input{
  border:none; outline:none; resize:none; font-family:inherit;
  font-size:15px; line-height:20px; max-height:100px;
}

/* Emoji picker / reactions / typing… (giữ như cũ, rút gọn một số chỗ) */
.emoji-picker{
  position:absolute; bottom:100%; right:0; background:#fff; border-radius:12px;
  box-shadow:0 8px 30px rgba(0,0,0,.12); padding:16px; width:320px; max-height:300px;
  overflow-y:auto; z-index:20;
}
.emoji-category{ display:grid; grid-template-columns:repeat(8,1fr); gap:8px; margin-bottom:16px; }
.emoji-item{ font-size:24px; cursor:pointer; padding:8px; border-radius:8px; text-align:center; }
.emoji-item:hover{ background:#f0f0f0; }

.typing-indicator{ display:flex; align-items:center; padding:8px 12px; background:#f0f0f0; border-radius:18px; margin:2px 0; max-width:60px; }
.typing-dot{ width:8px; height:8px; border-radius:50%; background:#999; margin:0 1px; animation: typing 1.4s infinite ease-in-out; }
.typing-dot:nth-child(1){ animation-delay:-.32s; } .typing-dot:nth-child(2){ animation-delay:-.16s; }
@keyframes typing{ 0%,80%,100%{ transform:scale(.8); opacity:.5;} 40%{ transform:scale(1); opacity:1;} }

.voice-message{ display:flex; align-items:center; gap:8px; padding:8px 12px; background:#f0f0f0; border-radius:18px; min-width:200px; }
.voice-message.sent{ background:rgba(255,255,255,.2); color:#fff; }
.voice-waveform{ display:flex; align-items:center; gap:2px; flex:1; }
.wave-bar{ width:3px; background:#0084ff; border-radius:2px; animation: wave 1s infinite ease-in-out; }
.voice-message.sent .wave-bar{ background:#fff; }
@keyframes wave{ 0%,100%{ height:4px; } 50%{ height:16px; } }

.image-message{ border-radius:12px; overflow:hidden; max-width:300px; cursor:pointer; }
.image-message img{ width:100%; height:auto; display:block; }

.file-message{ display:flex; align-items:center; gap:12px; padding:12px; background:#f0f0f0; border-radius:12px; max-width:300px; cursor:pointer; }
.file-message.sent{ background:rgba(255,255,255,.2); color:#fff; }

.call-message{ display:flex; align-items:center; gap:8px; padding:8px 12px; background:#f0f0f0; border-radius:18px; color:#65676b; }
.call-message.missed{ color:#e41e3f; }

.message-reactions{
  position:absolute; bottom:-12px; right:8px; background:#fff; border-radius:12px;
  padding:2px 6px; box-shadow:0 2px 8px rgba(0,0,0,.1); font-size:12px; display:flex; align-items:center; gap:2px;
}

.active-call-bar{
  background:linear-gradient(90deg,#00d4aa 0%,#00b894 100%); color:#fff;
  padding:8px 16px; display:flex; align-items:center; justify-content:space-between; font-size:14px; font-weight:500;
}
.call-duration{ font-family:monospace; font-size:13px; }
.call-overlay{
  position:fixed; z-index:99999 !important;
  inset:0; width:100vw; height:100vh;
  background:rgba(0,0,0,.92);
  display:none; align-items:center; justify-content:center;
}
.call-overlay.active{ display:flex; }
.call-overlay.hidden{ display:none; }
.call-card{ background:#0f172a; color:#e2e8f0; border-radius:20px; min-width:360px; min-height:320px; padding:28px; display:flex; flex-direction:column; align-items:center; gap:16px; box-shadow:0 30px 80px rgba(0,0,0,.45); }
.call-title{ font-size:20px; font-weight:700; }
.call-avatar{ width:120px; height:120px; border-radius:9999px; background:linear-gradient(135deg,#3b82f6,#8b5cf6); display:flex; align-items:center; justify-content:center; color:#fff; font-weight:800; font-size:48px; box-shadow:0 10px 30px rgba(59,130,246,.35); }
.call-controls{ display:flex; gap:12px; margin-top:8px; }
.call-btn{ width:56px; height:56px; border-radius:9999px; border:none; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:20px; background:#1f2937; color:#fff; }
.call-btn:hover{ background:#374151; }
.call-btn.end{ background:#ef4444; }
.call-btn.end:hover{ background:#dc2626; }
.call-duration{ font-family:ui-monospace,Menlo,Consolas,monospace; font-size:14px; opacity:.85; }

/* … (các phần style chat còn lại của bạn giữ nguyên nếu có) … */
 .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .message-bubble {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .typing-indicator {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }
        .call-animation {
            animation: callPulse 2s infinite;
        }
        @keyframes callPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .messenger-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .chat-search-highlight {
            background-color: #fef3c7;
            padding: 2px 4px;
            border-radius: 4px;
        }
        .file-upload-area {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        .file-upload-area:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }/* Panel info overlay bên phải, không chiếm chỗ layout */
#chatInfoPanel{
  position: absolute;       /* overlay thay vì chiếm cột */
  right: 0; top: 0; bottom: 0;
  width: 320px;             /* = w-80 */
  display: none;            /* .open => flex */
  background: #fff;
  border-left: 1px solid #e5e7eb;
  z-index: 30;
}
#chatInfoPanel.open { display: flex; flex-direction: column; }

/* Đảm bảo vùng chat có thể cuộn, không bị “đẩy” mất input */
#mainChatArea{ min-width: 0; min-height: 0; }
#messagesContainer{ min-height: 0; }

/* khi sidebar thu gọn */
.main-content.main-content-collapsed{
  margin-left: var(--sidebar-wc) !important;
}
/* layout nội dung chính */
.main-content{
margin-left: var(--sidebar-w);
margin-top: var(--header-h);
min-height: calc(100vh - var(--header-h));
height: calc(100vh - var(--header-h));
overflow: auto;

}
.main-content.main-content-collapsed{
  margin-left: var(--sidebar-wc);
} 
.main-content.main-content-collapsed{ margin-left: var(--sidebar-wc); }
.call-overlay {
  position: fixed;
  z-index: 99999 !important;
  inset: 0;
  width: 100vw;
  height: 100vh;
  background: #151e30;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  transition: opacity 0.2s;
}
.call-overlay.active {
  display: flex;
  opacity: 1;
}
.call-overlay.hidden {
  display: none;
  opacity: 0;
}
/* === Fullscreen cho voice/video/meeting === */
.call-active #header,
.call-active #sidebar { display: none !important; }

.call-active #mainContent,
.call-active .main-content {
  margin-left: 0 !important;
  margin-top: 0 !important;
}

/* Ép các modal phòng họp/thoại/video full màn hình nếu CSS cũ chưa set */
#meetingRoomModal,
#voiceCallModal,
#videoCallModal,
.meeting-modal,
.voice-call-modal,
.video-call-modal,
[data-modal="meeting"],
[data-modal="voice-call"],
[data-modal="video-call"]{
  position: fixed;
  inset: 0;
  z-index: 99999;
  /* JS sẽ set display:flex nếu hiện đang bị ẩn bằng display:none */
}
